{"version":3,"file":"react-email-editor.cjs.production.min.js","sources":["../src/loadScript.ts","../src/EmailEditor.tsx"],"sourcesContent":["const defaultScriptUrl = 'https://editor.unlayer.com/embed.js?2';\nconst callbacks: Function[] = [];\nlet loaded = false;\n\nconst isScriptInjected = (scriptUrl: string) => {\n  const scripts = document.querySelectorAll('script');\n  let injected = false;\n\n  scripts.forEach((script) => {\n    if (script.src.includes(scriptUrl)) {\n      injected = true;\n    }\n  });\n\n  return injected;\n};\n\nconst addCallback = (callback: Function) => {\n  callbacks.push(callback);\n};\n\nconst runCallbacks = () => {\n  if (loaded) {\n    let callback;\n\n    while ((callback = callbacks.shift())) {\n      callback();\n    }\n  }\n};\n\nexport const loadScript = (\n  callback: Function,\n  scriptUrl = defaultScriptUrl\n) => {\n  addCallback(callback);\n\n  if (!isScriptInjected(scriptUrl)) {\n    const embedScript = document.createElement('script');\n    embedScript.setAttribute('src', scriptUrl);\n    embedScript.onload = () => {\n      loaded = true;\n      runCallbacks();\n    };\n    document.head.appendChild(embedScript);\n  } else {\n    runCallbacks();\n  }\n};\n","import React, {\n  useEffect,\n  useRef,\n  useState,\n  useImperativeHandle,\n  useCallback,\n} from 'react';\n\nimport {\n  AddEventListener,\n  Editor,\n  EmailEditorProps,\n  EditorRef,\n  ExportHtml,\n  LoadBlank,\n  LoadDesign,\n  RegisterCallback,\n  SaveDesign,\n  SetMergeTags,\n  ExportImage,\n  RemoveEventListener,\n} from './types';\n\nimport pkg from '../package.json';\nimport { loadScript } from './loadScript';\n\nlet lastEditorId = 0;\n\nexport const EmailEditor = React.forwardRef<EditorRef, EmailEditorProps>(\n  (props, ref) => {\n    const { onLoad, onReady, scriptUrl, minHeight = 500, style = {} } = props;\n\n    const editorId = useRef(props.editorId || `editor-${++lastEditorId}`);\n    const isLoadedRef = useRef(false);\n\n    const [editor, setEditor] = useState<Editor | null>(null);\n\n    const loadEditor = useCallback(() => {\n      if (isLoadedRef.current) return;\n      isLoadedRef.current = true;\n\n      const options = props.options || {};\n\n      if (props.projectId) options.projectId = props.projectId;\n      if (props.tools) options.tools = props.tools;\n      if (props.appearance) options.appearance = props.appearance;\n      if (props.locale) options.locale = props.locale;\n\n      setEditor(\n        unlayer.createEditor({\n          ...options,\n          id: editorId.current,\n          displayMode: 'email',\n          source: {\n            name: pkg.name,\n            version: pkg.version,\n          },\n        })\n      );\n    }, [\n      editorId.current,\n      props.appearance,\n      props.locale,\n      props.options,\n      props.projectId,\n      props.tools,\n    ]);\n\n    const addEventListener = useCallback<AddEventListener>(\n      (type, callback) => {\n        editor?.addEventListener(type, callback);\n      },\n      [editor]\n    );\n\n    const removeEventListener = useCallback<RemoveEventListener>(\n      (type, callback) => {\n        editor?.removeEventListener(type, callback);\n      },\n      [editor]\n    );\n\n    const registerCallback = useCallback<RegisterCallback>(\n      (type, callback) => {\n        editor?.registerCallback(type as any, callback as any);\n      },\n      [editor]\n    );\n\n    const loadDesign = useCallback<LoadDesign>(\n      (design) => {\n        editor?.loadDesign(design);\n      },\n      [editor]\n    );\n\n    const saveDesign = useCallback<SaveDesign>(\n      (callback) => {\n        editor?.saveDesign(callback);\n      },\n      [editor]\n    );\n\n    const exportHtml = useCallback<ExportHtml>(\n      (callback, options) => {\n        editor?.exportHtml(callback, options);\n      },\n      [editor]\n    );\n\n    const exportImage = useCallback<ExportImage>(\n      (callback) => {\n        editor?.exportImage(callback);\n      },\n      [editor]\n    );\n\n    const setMergeTags = useCallback<SetMergeTags>(\n      (mergeTags) => {\n        editor?.setMergeTags(mergeTags);\n      },\n      [editor]\n    );\n\n    const loadBlank = useCallback<LoadBlank>(\n      (options) => {\n        editor?.loadBlank(options);\n      },\n      [editor]\n    );\n\n    useEffect(() => {\n      loadScript(loadEditor, scriptUrl);\n    }, [loadEditor, scriptUrl]);\n\n    useEffect(() => {\n      if (!editor) return;\n\n      // All properties starting with on[Name] are registered as event listeners.\n      for (const [key, value] of Object.entries(props)) {\n        if (/^on/.test(key) && key !== 'onLoad' && key !== 'onReady') {\n          addEventListener(key, value);\n        }\n      }\n\n      // @deprecated\n      onLoad && onLoad();\n\n      if (onReady) editor.addEventListener('editor:ready', onReady);\n    }, [editor, addEventListener, onLoad, onReady, props]);\n\n    useImperativeHandle(\n      ref,\n      () => ({\n        saveDesign,\n        exportHtml,\n        setMergeTags,\n        editor,\n        loadDesign,\n        registerCallback,\n        addEventListener,\n        loadBlank,\n        exportImage,\n        removeEventListener,\n      }),\n      [\n        saveDesign,\n        exportHtml,\n        setMergeTags,\n        editor,\n        loadDesign,\n        registerCallback,\n        addEventListener,\n        loadBlank,\n        exportImage,\n        removeEventListener,\n      ]\n    );\n\n    return (\n      <div\n        style={{\n          flex: 1,\n          display: 'flex',\n          minHeight: minHeight,\n        }}\n      >\n        <div id={editorId.current} style={{ ...style, flex: 1 }} />\n      </div>\n    );\n  }\n);\n"],"names":["callbacks","loaded","runCallbacks","callback","shift","lastEditorId","EmailEditor","React","forwardRef","props","ref","onLoad","onReady","scriptUrl","_props$minHeight","minHeight","_props$style","style","editorId","useRef","isLoadedRef","_useState","useState","editor","setEditor","loadEditor","useCallback","current","options","projectId","tools","appearance","locale","unlayer","createEditor","_extends","id","displayMode","source","name","version","addEventListener","type","removeEventListener","registerCallback","loadDesign","design","saveDesign","exportHtml","exportImage","setMergeTags","mergeTags","loadBlank","useEffect","push","addCallback","scripts","document","querySelectorAll","injected","forEach","script","src","includes","isScriptInjected","embedScript","createElement","setAttribute","onload","head","appendChild","loadScript","_i","_Object$entries","Object","entries","length","_Object$entries$_i","key","value","test","useImperativeHandle","flex","display"],"mappings":"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"}